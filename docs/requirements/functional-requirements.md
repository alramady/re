# Functional Requirements — Munsiq

## AUTH Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-AUTH-001 | النظام يجب أن يسمح بتسجيل الدخول عبر email + password | P1 | JWT صالح يُرجع خلال 2 ثانية | UC-015 |
| FR-AUTH-002 | النظام يجب أن يدعم MFA عبر OTP (SMS) | P1 | OTP يُرسل خلال 30 ثانية، صالح لـ 5 دقائق | UC-015 |
| FR-AUTH-003 | النظام يجب أن يطبّق RBAC بـ 6 أدوار محددة | P1 | كل endpoint محمي بصلاحية محددة | UC-015 |
| FR-AUTH-004 | النظام يجب أن يدعم إنشاء/تعديل/تعطيل المستخدمين | P1 | SuperAdmin يستطيع إدارة جميع المستخدمين | UC-015 |
| FR-AUTH-005 | النظام يجب أن يسجّل كل عملية دخول/خروج في audit log | P1 | سجل يحتوي: userId, action, timestamp, IP | UC-020 |
| FR-AUTH-006 | النظام يجب أن يقفل الحساب بعد 5 محاولات فاشلة | P1 | قفل 30 دقيقة + إشعار email | UC-015 |
| FR-AUTH-007 | النظام يجب أن يدعم تغيير كلمة المرور | P2 | تأكيد الكلمة القديمة + validation rules | UC-015 |
| FR-AUTH-008 | النظام يجب أن يدعم استعادة كلمة المرور عبر email | P2 | رابط صالح لـ 1 ساعة | UC-015 |

## PROP Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-PROP-001 | النظام يجب أن يسمح بإضافة عقار بالبيانات: اسم، عنوان، نوع، إحداثيات | P1 | عقار محفوظ + يظهر في القائمة | UC-001 |
| FR-PROP-002 | النظام يجب أن يسمح بإضافة وحدات لكل عقار | P1 | وحدة مرتبطة بعقار + رقم فريد | UC-002 |
| FR-PROP-003 | النظام يجب أن يدعم البحث والفلترة في العقارات | P1 | بحث بالاسم/النوع/الحالة خلال < 1 ثانية | UC-001 |
| FR-PROP-004 | النظام يجب أن يعرض موقع العقار على خريطة | P1 | Google Maps marker بالإحداثيات | UC-001 |
| FR-PROP-005 | النظام يجب أن يسمح برفع صور ومستندات للعقار | P2 | ملفات مخزنة في S3، حد 10MB/ملف | UC-018 |
| FR-PROP-006 | النظام يجب أن يدعم أرشفة العقار | P2 | عقار مؤرشف لا يظهر في القوائم الافتراضية | UC-001 |
| FR-PROP-007 | النظام يجب أن يعرض نسبة إشغال كل عقار | P2 | نسبة = وحدات مؤجرة / إجمالي الوحدات | UC-017 |

## TNT Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-TNT-001 | النظام يجب أن يسمح بتسجيل مستأجر جديد | P1 | بيانات: اسم، هوية، جوال، email | UC-003 |
| FR-TNT-002 | النظام يجب أن يدعم التحقق من هوية المستأجر عبر Nafath | P1 | حالة التحقق: VERIFIED/PENDING/FAILED | UC-004 |
| FR-TNT-003 | النظام يجب أن يعرض ملف المستأجر الكامل | P1 | عقود، مدفوعات، طلبات صيانة | UC-003 |
| FR-TNT-004 | النظام يجب أن يسمح بتعديل بيانات المستأجر | P1 | تعديل مع audit trail | UC-003 |
| FR-TNT-005 | النظام يجب أن يدعم بحث المستأجرين | P2 | بحث بالاسم/الهوية/الجوال | UC-003 |
| FR-TNT-006 | النظام يجب أن يشفّر PII المستأجر at rest | P2 | AES-256 encryption للحقول الحساسة | UC-003 |

## CNTR Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-CNTR-001 | النظام يجب أن يسمح بإنشاء عقد إيجار | P1 | ربط: عقار + وحدة + مستأجر + شروط مالية | UC-005 |
| FR-CNTR-002 | النظام يجب أن يتحقق من توافق العقد مع متطلبات إيجار | P1 | validation rules لجميع الحقول الإلزامية | UC-005 |
| FR-CNTR-003 | النظام يجب أن يرسل العقد لنظام إيجار عبر API | P1 | حالة: SYNCED/FAILED + retry 3 مرات | UC-006 |
| FR-CNTR-004 | النظام يجب أن يستقبل تأكيد إيجار ويحدّث الحالة | P1 | حالة العقد تتحول لـ ACTIVE | UC-006 |
| FR-CNTR-005 | النظام يجب أن يولّد جدول دفعات تلقائي | P1 | فواتير شهرية/ربعية/سنوية حسب العقد | UC-007 |
| FR-CNTR-006 | النظام يجب أن يدعم تجديد العقد | P1 | عقد جديد مرتبط بالقديم + مزامنة إيجار | UC-013 |
| FR-CNTR-007 | النظام يجب أن يدعم إنهاء العقد المبكر | P1 | حساب غرامات + إشعار إيجار + تحديث حالة الوحدة | UC-014 |
| FR-CNTR-008 | النظام يجب أن يرسل إشعار قبل انتهاء العقد بـ 90/60/30 يوم | P2 | إشعارات مجدولة تلقائياً | UC-016 |
| FR-CNTR-009 | النظام يجب أن يسمح بطباعة العقد PDF | P2 | PDF يحتوي جميع البنود + QR code | UC-005 |
| FR-CNTR-010 | النظام يجب أن يحفظ تاريخ تعديلات العقد | P2 | version history لكل تعديل | UC-005 |

## PAY Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-PAY-001 | النظام يجب أن يولّد فاتورة SADAD لكل دفعة مستحقة | P1 | رقم فاتورة SADAD فريد | UC-007 |
| FR-PAY-002 | النظام يجب أن يستقبل إشعار الدفع من SADAD (webhook) | P1 | تحديث حالة الفاتورة خلال < 5 ثوانٍ | UC-008 |
| FR-PAY-003 | النظام يجب أن يولّد إيصال دفع PDF | P1 | إيصال يحتوي: مبلغ، تاريخ، رقم مرجعي | UC-008 |
| FR-PAY-004 | النظام يجب أن يحسب غرامات التأخير | P1 | حسب شروط العقد (نسبة أو مبلغ ثابت) | UC-007 |
| FR-PAY-005 | النظام يجب أن يعرض حالة المدفوعات للمستأجر | P1 | قائمة: مدفوعة/معلقة/متأخرة | UC-019 |
| FR-PAY-006 | النظام يجب أن يدعم الدفع الجزئي | P1 | تحديث الرصيد المتبقي | UC-008 |
| FR-PAY-007 | النظام يجب أن يولّد تقرير تحصيل شهري | P2 | إجمالي: محصّل/متأخر/نسبة التحصيل | UC-012 |
| FR-PAY-008 | النظام يجب أن يدعم تسوية يدوية (manual reconciliation) | P2 | Accountant يسجّل دفعة يدوية مع مرفق | UC-012 |

## MAINT Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-MAINT-001 | النظام يجب أن يسمح للمستأجر بإنشاء طلب صيانة | P1 | طلب: وصف + صور + أولوية + موقع | UC-009 |
| FR-MAINT-002 | النظام يجب أن يسمح بتعيين فني للطلب | P1 | إشعار للفني + تحديث حالة | UC-010 |
| FR-MAINT-003 | النظام يجب أن يتتبع حالة الطلب | P2 | حالات: NEW→ASSIGNED→IN_PROGRESS→COMPLETED→RATED | UC-010 |
| FR-MAINT-004 | النظام يجب أن يرسل إشعارات تحديث الحالة | P2 | SMS + In-app للمستأجر | UC-010 |
| FR-MAINT-005 | النظام يجب أن يسمح بتقييم الخدمة | P2 | تقييم 1-5 نجوم + تعليق | UC-011 |
| FR-MAINT-006 | النظام يجب أن يولّد تقرير صيانة شهري | P3 | عدد الطلبات/متوسط وقت الإنجاز/التقييمات | UC-012 |

## RPT Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-RPT-001 | النظام يجب أن يولّد تقرير مالي شامل | P1 | إيرادات/مصروفات/صافي — فلتر بالفترة | UC-012 |
| FR-RPT-002 | النظام يجب أن يولّد تقرير إشغال | P2 | نسبة إشغال لكل عقار/وحدة | UC-017 |
| FR-RPT-003 | النظام يجب أن يدعم تصدير PDF + Excel | P2 | ملف يُحمّل خلال < 10 ثوانٍ | UC-012 |
| FR-RPT-004 | النظام يجب أن يدعم تقارير مجدولة (scheduled) | P2 | إرسال تلقائي email أسبوعي/شهري | UC-012 |
| FR-RPT-005 | النظام يجب أن يعرض dashboard ملخص | P3 | widgets: إيرادات، إشغال، صيانة، تنبيهات | UC-017 |

## NOTIF Module

| FR-ID | Requirement | Priority | Acceptance Criteria | Trace (UC) |
|-------|------------|----------|-------------------|------------|
| FR-NOTIF-001 | النظام يجب أن يرسل SMS عبر Twilio | P1 | تسليم خلال 60 ثانية، retry 3 مرات | UC-016 |
| FR-NOTIF-002 | النظام يجب أن يرسل email عبر SES | P1 | قوالب HTML ثنائية اللغة | UC-016 |
| FR-NOTIF-003 | النظام يجب أن يدعم إشعارات In-app | P2 | real-time عبر WebSocket | UC-016 |
| FR-NOTIF-004 | النظام يجب أن يدعم Push notifications (PWA) | P2 | Service Worker + Web Push API | UC-016 |
| FR-NOTIF-005 | النظام يجب أن يسمح بإدارة تفضيلات الإشعارات | P2 | المستخدم يختار القنوات لكل نوع إشعار | UC-016 |
